# gameconfig å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£é¢å‘ gameconfig é¡¹ç›®çš„**ç»´æŠ¤è€…å’Œè´¡çŒ®è€…**ã€‚

**ä½¿ç”¨è€…æ–‡æ¡£**ï¼šå‚è€ƒ [README.md](README.md)

---

## é¡¹ç›®æ¦‚è§ˆ

gameconfig æ˜¯ä¸€ä¸ªæ¸¸æˆé…ç½®ç®¡ç†å·¥å…·ï¼Œæ”¯æŒåŒæ¨¡å¼é…ç½®åŠ è½½ï¼ˆExcel/CSVï¼‰ã€æ¡ä»¶å­—æ®µã€Schema è¿ç§»ã€Mock æ•°æ®æµ‹è¯•ã€‚

**Go Module**: `github.com/wangtengda0310/gobee/gameconfig`

---

## ä»£ç ç»“æ„

### ç›®å½•å¸ƒå±€

```
gameconfig/
â”œâ”€â”€ internal/config/          # æ ¸å¿ƒå®ç°ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ loader.go             # ç»Ÿä¸€åŠ è½½å™¨å…¥å£
â”‚   â”œâ”€â”€ excel.go              # Excel è¯»å–
â”‚   â”œâ”€â”€ csv.go                # CSV è¯»å–
â”‚   â”œâ”€â”€ mapper.go             # ç»“æ„ä½“åå°„æ˜ å°„
â”‚   â”œâ”€â”€ condition.go          # æ¡ä»¶å­—æ®µå¤„ç†
â”‚   â”œâ”€â”€ schema.go             # Schema ç‰ˆæœ¬ç®¡ç†
â”‚   â”œâ”€â”€ watcher.go            # çƒ­é‡è½½
â”‚   â”œâ”€â”€ exporter.go           # Excel å¯¼å‡ºå™¨
â”‚   â”œâ”€â”€ comment.go            # æ‰¹æ³¨å¤„ç†
â”‚   â”œâ”€â”€ errors.go             # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ test_helper.go        # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”‚   â””â”€â”€ *_test.go             # å•å…ƒæµ‹è¯•
â”œâ”€â”€ pkg/config/               # å¯¹å¤– API
â”‚   â””â”€â”€ config.go             # å…¬å¼€æ¥å£
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ xlsx2csv/             # Excel å¯¼å‡ºå·¥å…·
â”‚   â””â”€â”€ install-skill/        # Skill å®‰è£…å·¥å…·
â”œâ”€â”€ tests/                    # é›†æˆæµ‹è¯•å’Œå›å½’æµ‹è¯•
â”œâ”€â”€ testdata/                 # æµ‹è¯•æ•°æ®
â”œâ”€â”€ .claude/skills/gameconfig/ # Skill æºæ–‡ä»¶ï¼ˆå”¯ä¸€ä¿®æ”¹ä½ç½®ï¼‰
â”œâ”€â”€ scripts/                  # æ„å»ºå’Œç»´æŠ¤è„šæœ¬
â””â”€â”€ docs/                     # é¡¹ç›®æ–‡æ¡£
```

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           pkg/config (å¯¹å¤– API)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    internal/config (æ ¸å¿ƒå®ç°)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Loader  â”‚ â”‚ Mapper  â”‚ â”‚ Schema    â”‚  â”‚
â”‚  â”‚         â”‚ â”‚         â”‚ â”‚ Watcher   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     excelize (Excel) + fsnotify         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `internal/config/` å®ç°æ ¸å¿ƒé€»è¾‘
2. åœ¨ `pkg/config/` æš´éœ²å¯¹å¤– APIï¼ˆå¦‚éœ€è¦ï¼‰
3. ç¼–å†™å•å…ƒæµ‹è¯• `*_test.go`
4. åœ¨ `tests/` æ·»åŠ é›†æˆæµ‹è¯•ï¼ˆå¦‚é€‚ç”¨ï¼‰
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

### ä»£ç è§„èŒƒ

- **å†…éƒ¨å®ç°**ï¼šæ”¾åœ¨ `internal/config/`ï¼Œä¸å¯¹å¤–æš´éœ²
- **å…¬å¼€ API**ï¼šæ”¾åœ¨ `pkg/config/`ï¼Œä¿æŒå‘åå…¼å®¹
- **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨ `internal/config/errors.go` ä¸­çš„é”™è¯¯ç±»å‹
- **æµ‹è¯•ä¼˜å…ˆ**ï¼šæ¯ä¸ªæ–°åŠŸèƒ½éƒ½éœ€è¦å¯¹åº”çš„æµ‹è¯•

### å¸¸è§ä»»åŠ¡

#### æ·»åŠ æ–°çš„é…ç½®æ¨¡å¼

1. åœ¨ `internal/config/loader.go` æ·»åŠ æ–°çš„ Mode å¸¸é‡
2. å®ç°å¯¹åº”çš„åŠ è½½é€»è¾‘
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
4. æ›´æ–° README.md ä¸­çš„æ¨¡å¼è¯´æ˜

#### æ·»åŠ æ–°çš„ Struct Tag

1. åœ¨ `internal/config/mapper.go` æ‰©å±• tag è§£æ
2. æ›´æ–° `FieldMeta` ç»“æ„ï¼ˆå¦‚éœ€è¦ï¼‰
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
4. æ›´æ–° README.md ä¸­çš„ tag è¯´æ˜

---

## Skill æ–‡ä»¶ç»´æŠ¤

### å”¯ä¸€ä¿®æ”¹ä½ç½®

**æ‰€æœ‰ skill å†…å®¹éƒ½åœ¨è¿™é‡Œä¿®æ”¹**ï¼š
```
.claude/skills/gameconfig/
â”œâ”€â”€ SKILL.md              # ä¸» skill æ–‡ä»¶
â”œâ”€â”€ abilities/
â”‚   â””â”€â”€ AIæŒ‡å¯¼.md          # AI èƒ½åŠ›æŒ‡å¯¼
â””â”€â”€ README.md
```

### åŒæ­¥åˆ°å®‰è£…å·¥å…·

ä¿®æ”¹ skill åï¼Œ**å¿…é¡»åŒæ­¥**åˆ°åµŒå…¥æ–‡ä»¶ï¼š

```bash
cd cmd/install-skill
go generate
git add skills/
```

### éªŒè¯åŒæ­¥

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒæ­¥
bash scripts/check-sync.sh

# è¿è¡Œå®Œæ•´æµ‹è¯•
go test ./tests/... -run TestInstallSkill -v
```

### Skill å†…å®¹åŸåˆ™

- **é¢å‘ AI**ï¼šä½¿ç”¨ç®€æ´çš„æŒ‡ä»¤å’Œç¤ºä¾‹
- **ä»£ç å¼•ç”¨**ï¼šä½¿ç”¨ `file:line` æ ¼å¼
- **æ¸è¿›å¼æŠ«éœ²**ï¼šå…ˆç®€å•åå¤æ‚
- **åœºæ™¯é©±åŠ¨**ï¼šæŒ‰ç”¨æˆ·ä½¿ç”¨åœºæ™¯ç»„ç»‡

---

## æµ‹è¯•

### æµ‹è¯•ç»“æ„

| ç±»å‹ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| **å•å…ƒæµ‹è¯•** | `internal/config/*_test.go` | æµ‹è¯•å•ä¸ªåŠŸèƒ½ |
| **é›†æˆæµ‹è¯•** | `tests/integration_test.go` | æµ‹è¯•å®Œæ•´æµç¨‹ |
| **å›å½’æµ‹è¯•** | `tests/regression_test.go` | é˜²æ­¢ bug å†ç° |
| **å®‰è£…æµ‹è¯•** | `tests/install_skill_test.go` | æµ‹è¯• skill å®‰è£… |

### è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test ./internal/config/... -v

# é›†æˆæµ‹è¯•
go test ./tests/... -v

# å›å½’æµ‹è¯•
go test ./tests/... -run TestRegression

# å¸¦ç«æ€æ£€æµ‹
go test ./... -race

# è¦†ç›–ç‡
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

### æ·»åŠ å›å½’æµ‹è¯•

ä¿®å¤ bug åï¼Œåœ¨ `tests/regression_test.go` æ·»åŠ å¯¹åº”çš„å›å½’æµ‹è¯•ï¼š

```go
// TestRegression_IssueX_<æè¿°> æµ‹è¯•<ç®€è¦æè¿°>
//
// é—®é¢˜æè¿°ï¼š<è¯¦ç»†æè¿° bug çš„è¡¨ç°>
//
// å¤ç°æ­¥éª¤ï¼š
//   <ä»£ç ç¤ºä¾‹>
//
// è§£å†³æ–¹æ¡ˆï¼š<å¦‚ä½•ä¿®å¤çš„>
//
// ä¿®å¤æ—¥æœŸï¼šYYYY-MM-DD
//
// ç›¸å…³æäº¤ï¼š<commit hash> <commit message>
//
// æµ‹è¯•è¦†ç›–ï¼š<æµ‹è¯•éªŒè¯äº†ä»€ä¹ˆ>
func TestRegression_IssueX_...(t *testing.T) {
    // æµ‹è¯•ä»£ç 
}
```

è¯¦ç»†è¯´æ˜ï¼š[tests/REGRESSION.md](tests/REGRESSION.md)

---

## å‘å¸ƒæµç¨‹

### å‘å¸ƒå‰æ£€æŸ¥

```bash
# 1. æ£€æŸ¥ skill åŒæ­¥
cd cmd/install-skill && go generate

# 2. è¿è¡Œå®Œæ•´æµ‹è¯•
go test ./... -v

# 3. è¿è¡Œå›å½’æµ‹è¯•
go test ./tests/... -run TestRegression

# 4. æ£€æŸ¥ git çŠ¶æ€
git status
```

### ç‰ˆæœ¬å‘å¸ƒæ­¥éª¤

1. æ›´æ–° `CHANGELOG.md`
2. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¦‚æœ‰ï¼‰
3. åˆ›å»º git tag
4. æ¨é€åˆ°è¿œç¨‹

```bash
git tag -a v1.x.x -m "Release v1.x.x"
git push origin v1.x.x
```

---

## å¸¸è§é—®é¢˜

### å¹¶å‘å®‰å…¨

- âœ… å¤š goroutine åŒæ—¶è¯»å–ï¼šæ”¯æŒ
- âš ï¸ SetMockData å¹¶å‘ï¼šæœ‰é”ä¿æŠ¤ï¼Œä½†æœ€ç»ˆå€¼ä¸ç¡®å®š

### é”™è¯¯å¤„ç†

æ‰€æœ‰é”™è¯¯å®šä¹‰åœ¨ `internal/config/errors.go`ï¼Œä½¿ç”¨ `errors.Join()` ç»„åˆå¤šä¸ªé”™è¯¯ã€‚

### æ€§èƒ½è€ƒè™‘

- ä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤ç¼“å­˜
- StructMapper ç¼“å­˜åå°„ç»“æœ
- é¿å…é¢‘ç¹çš„æ–‡ä»¶ I/O

---

## ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ | è¯»è€… |
|------|------|------|
| [README.md](README.md) | ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹ | ä½¿ç”¨è€… |
| [DESIGN.md](DESIGN.md) | è®¾è®¡æ–‡æ¡£ | å¼€å‘è€… |
| [CHANGELOG.md](CHANGELOG.md) | ç‰ˆæœ¬å˜æ›´è®°å½• | æ‰€æœ‰äºº |
| [AI_NATIVE.md](AI_NATIVE.md) | AI åŸç”Ÿè§„åˆ’ | å¼€å‘è€… |
| [docs/DEVELOPER.md](docs/DEVELOPER.md) | è¯¦ç»†å¼€å‘è€…æŒ‡å— | å¼€å‘è€… |
| [tests/REGRESSION.md](tests/REGRESSION.md) | å›å½’æµ‹è¯•ç´¢å¼• | å¼€å‘è€… |

---

## AI åŸç”Ÿè§„åˆ’

gameconfig æ­£åœ¨æ¼”è¿›ä¸º AI åŸç”Ÿå¼€å‘å·¥å…·ï¼Œæœªæ¥å°†æ”¯æŒï¼š
- ğŸ¯ AI ä¸»åŠ¨é…ç½®é…ç½®è¡¨
- ğŸ” AI å®¡æŸ¥å’Œä¼˜åŒ–é…ç½®
- ğŸ§ª AI è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®
- ğŸ“Š AI ç”Ÿæˆæ–‡æ¡£å’Œç¤ºä¾‹

è¯¦ç»†è§„åˆ’ï¼š[AI_NATIVE.md](AI_NATIVE.md)
